<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reproductor M3U8 Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        body {font-family:'Roboto',Arial,sans-serif;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);color:#fff;min-height:100vh;margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
        .container {background:rgba(0,0,0,0.7);padding:2rem 2.2rem 2.4rem;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.2);max-width:460px;width:100%;}
        h1 {text-align:center;margin:0 0 1.2rem;font-weight:700;font-size:1.45rem;}
        input[type=text] {width:100%;padding:.7rem .85rem;border-radius:8px;border:none;margin-bottom:1rem;font-size:.95rem;box-sizing:border-box;}
        button {width:100%;padding:.7rem;border-radius:8px;border:none;background:#2a5298;color:#fff;font-size:1rem;font-weight:700;cursor:pointer;transition:background .2s;}
        button:hover {background:#1e3c72;}
        #video-container {margin-top:1.4rem;text-align:center;}
        video {width:100%;max-width:420px;border-radius:12px;background:#000;}
        .credit {margin-top:1.6rem;font-size:.8rem;color:#ccc;text-align:center;}
        .credit a {color:#fff;text-decoration:underline;}
        /* Historial */
        .history {margin-top:1.9rem;}
        .history h2 {margin:0 0 .65rem;font-size:.95rem;letter-spacing:.5px;}
        .history-actions {display:flex;gap:.55rem;margin-bottom:.55rem;}
        .history-actions button.small {flex:1;padding:.45rem .5rem;font-size:.67rem;font-weight:600;letter-spacing:.5px;}
        .history-list {max-height:240px;overflow-y:auto;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.12);border-radius:10px;padding:.35rem .4rem;scrollbar-width:thin;}
    .history-item {display:grid;grid-template-columns:1fr auto;column-gap:.65rem;align-items:flex-start;padding:.55rem .65rem;margin:.15rem 0;border-radius:10px;background:linear-gradient(145deg,rgba(255,255,255,0.07),rgba(255,255,255,0.02));cursor:default;transition:background .18s,transform .18s;position:relative;}
    .history-item:hover {background:rgba(255,255,255,0.16);}
    .history-name {font-size:.66rem;line-height:1.1rem;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;word-break:break-word;user-select:text;}
    .history-item.expanded .history-name {-webkit-line-clamp:unset;max-height:none;}
    .history-buttons {display:flex;flex-direction:column;gap:.32rem;align-items:flex-end;min-width:58px;}
    .history-buttons button {width:auto;padding:.28rem .55rem;font-size:.56rem;font-weight:600;letter-spacing:.4px;background:#2a5298;}
    .history-buttons button:hover {background:#1e3c72;}
    .history-buttons button.toggle {background:#555a70;}
    .history-buttons button.toggle.active {background:#2f7c4d;}
        .empty-history {text-align:center;font-size:.65rem;padding:.85rem .4rem;color:#b8c4d6;}
        .toggle-expand-btn.active {background:#1e3c72;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Reproductor M3U8 Online</h1>
        <input type="text" id="m3u8-url" placeholder="Pega aquí la URL M3U8..." value="https://example.com/playlist.m3u8" />
        <button onclick="playM3U8()">Reproducir</button>
        <div id="video-container"></div>
        <div class="history" id="history">
            <h2>Historial</h2>
            <div class="history-actions">
                <button class="small toggle-expand-btn" onclick="toggleExpandHistory(this)">Expandir nombres</button>
                <button class="small" onclick="clearHistory()">Limpiar</button>
            </div>
            <div id="history-list" class="history-list"></div>
        </div>
    </div>
    <div class="credit">Desarrollado con <a href="https://github.com/video-dev/hls.js/" target="_blank">hls.js</a></div>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const HISTORY_KEY='m3u8HistoryList';
        const MAX_HISTORY=120;
        function getHistory(){try{return JSON.parse(localStorage.getItem(HISTORY_KEY))||[];}catch{return[]}}
        function saveHistory(list){localStorage.setItem(HISTORY_KEY,JSON.stringify(list.slice(0,MAX_HISTORY)));}
        function addToHistory(url){if(!url)return;let list=getHistory();const idx=list.findIndex(i=>i.url===url);if(idx!==-1){const it=list.splice(idx,1)[0];list.unshift(it);}else{list.unshift({url,date:Date.now()});}saveHistory(list);renderHistory();}
        function clearHistory(){if(!confirm('¿Limpiar historial?'))return;localStorage.removeItem(HISTORY_KEY);renderHistory();}
        function playFromHistory(url){document.getElementById('m3u8-url').value=url;playM3U8();}
        function copyToClipboard(text,btn){navigator.clipboard.writeText(text).then(()=>{const t=btn.textContent;btn.textContent='Copiado';setTimeout(()=>btn.textContent=t,1400);});}
        function toggleExpandHistory(button){const list=document.getElementById('history-list');const on=list.classList.toggle('expanded');button.classList.toggle('active',on);button.textContent=on?'Contraer nombres':'Expandir nombres';}
        function formatDate(ts){const d=new Date(ts);return d.toLocaleString();}
        function escapeHtml(str){return str.replace(/[&<>"']/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));}
    function renderHistory(){const el=document.getElementById('history-list');const list=getHistory();if(!list.length){el.innerHTML='<div class="empty-history">Vacío</div>';return;}el.innerHTML=list.map(item=>{const safe=escapeHtml(item.url);return `<div class=\"history-item\" title=\"${safe}\n${formatDate(item.date)}\">\n<div class=\"history-name\">${safe}</div>\n<div class=\"history-buttons\">\n<button onclick=\"playFromHistory('${safe}')\">Play</button>\n<button onclick=\"copyToClipboard('${safe}', this)\">Copiar</button>\n<button class=\"toggle\" onclick=\"toggleItemExpand(this)\" title=\"Expandir/contraer\">↕</button>\n</div>\n</div>`}).join('');}
    function toggleItemExpand(btn){const item=btn.closest('.history-item');const on=item.classList.toggle('expanded');btn.classList.toggle('active',on);}        
        function playM3U8(){const url=document.getElementById('m3u8-url').value.trim();const container=document.getElementById('video-container');container.innerHTML='';if(!url){container.innerHTML='<p>Por favor ingresa una URL M3U8 válida.</p>';return;}const video=document.createElement('video');video.controls=true;video.autoplay=true;video.style.marginTop='1rem';container.appendChild(video);if(Hls.isSupported()){const hls=new Hls();hls.loadSource(url);hls.attachMedia(video);hls.on(Hls.Events.ERROR,(event,data)=>{if(data.fatal){container.innerHTML='<p style="color:#ff8080">Error al cargar el video M3U8.</p>';}});}else if(video.canPlayType('application/vnd.apple.mpegurl')){video.src=url;video.addEventListener('error',()=>{container.innerHTML='<p style="color:#ff8080">Error al cargar el video M3U8.</p>';});}else{container.innerHTML='<p>Tu navegador no soporta reproducción M3U8.</p>';}addToHistory(url);} 
        renderHistory();
    </script>
</body>
</html>
